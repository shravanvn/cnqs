#!/bin/bash

#SBATCH --job-name="cnqs_lattice_005_005_run_01"
#SBATCH --output="runs/lattice_005_005/run_01/%j.out"

#SBATCH --mail-type="BEGIN,END,TIME_LIMIT,FAIL"
#SBATCH --mail-user="saibalde@umich.edu"

#SBATCH --account=lsa1
#SBATCH --partition=standard
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=16
#SBATCH --mem-per-cpu=5G
#SBATCH --time=7-00:00:00

#SBATCH --export=ALL

TIMESTAMP=`date '+%Y-%m-%dT%H:%M:%S'`
WORKDIR='runs/lattice_005_005/run_01'

module purge
module load python3.8-anaconda/2020.07

echo 'Running on:'
echo '==========='
scontrol show hostnames ${SLURM_JOB_NODELIST}
echo ''

echo 'Program Output:'
echo '==============='
python main.py --config_file ${WORKDIR}/config.yaml --output_file ${WORKDIR}/${SLURM_JOB_ID}_output_${TIMESTAMP}.csv
echo ''

rm -f ${WORKDIR}/output.csv
cd ${WORKDIR} && ln -s ${SLURM_JOB_ID}_output_${TIMESTAMP}.csv output.csv && cd -

echo 'Program Statistics:'
echo '==================='
sstat -j ${SLURM_JOB_ID} --format='AveRSS,MaxRSS'
